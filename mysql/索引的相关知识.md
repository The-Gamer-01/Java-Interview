# 索引的底层数据结构选择
索引的底层数据结构使用的是B+树，作为技术人员，我们得比较选择最合适的数据结构；
在平时的索引数据结构分析中，常见的几种数据结构为：**哈希表、有序数组、搜索树**
## 哈希表
哈希表是一个**key-value**映射的数据结构，根据key的值算出其对应的hash值，插入数组中对应的hash值的位置，然后如果hash冲突，那么便在数组后面拉出一个链表；
其查询效率和插入效率非常优秀，但是其范围查询的实现困难，只适用于等值查询的场景；

## 有序数组
有序数组的查询效率十分优秀，范围查询的效率也十分优秀，但是在插入数据的时候数据要一个一个往后移动，适合做静态存储引擎的索引实现；
## 搜索树
我们在大学里面学习数据结构的时候，最常使用到的便是二叉树，但是在实际的应用场景中，我们经常使用多叉树；
在MySQL的Innodb引擎中，索引的实现使用的是B+树；

# 索引的类别
索引主要分为五类索引
1. 主键索引
2. 普通索引
3. 唯一索引
4. 组合索引
5. 全文索引

## 主键索引
定义：主键上建立的索引，唯一且不为空，表中只能有一个
主键索引到了整个一行的数据，所以利用主键索引可以不需要回表；主键索引也被称为聚簇索引；
## 普通索引
定义：设置单个字段作为索引
作用：加速搜索
## 唯一索引
定义：设置单个字段作为索引，并且该索引不会重复，可以为null
## 组合索引
定义：设置多个字段作为索引
## 全文索引
定义：对文本内容分词进行搜索
### 回表
索引我们可以划分为**聚簇索引和非聚簇索引**；
聚簇索引又叫主键索引，其索引指向了一行的所有记录；
非聚簇索引又叫二级索引，其索引到的value是那一行的主键ID，然后根据主键ID再查询到那一行的数据，其过程称为回表；

### change buffer
change buffer是Innodb对于普通索引的一个优化机制，其操作相当于是在更新数据页的时候，先不把更新持久化到硬盘，待到下一次查询的时候，将该数据所在的数据页读取到内存中，然后根据change buffer来修改内容，保证数理逻辑的正确性；

change buffer中的操作应用到原数据页中的过程叫做merge，merge会在三种情况下触发：
1. 查询到该数据页时
2. 后台会定期进行merge
3. 数据库关闭的时候会进行merge

merge可以减少读取硬盘的次数，同时一定程度上减少了内存的使用，提高内存利用率；

唯一索引因为要先判断是否违反唯一约束，所以他必须把数据先读取到内存中，而因为先读取到了内存中了，那么其实就不用change buffer进行优化了，而是直接进行修改，所以唯一索引不用changebuffer；
普通索引则可以使用changebuffer进行优化；

在插入数据的时候，我们需要分两种情况分析
一、所需要的数据页在内存中
+ 对于普通索引来说，我们需要找到一个位置插入数据
+ 对于唯一索引来说，我们在找到其对应的位置的时候，判断一次是否违反唯一约束然后在插入

其差别其实只是一次判断，所以差别不大；
二、所需要的数据页不在内存中
+ 对于普通索引来说，我们直接记录到changebuffer上即可；
+ 对于唯一索引，那么我们就需要直接写入到磁盘；

对于磁盘的IO操作十分影响性能，所以我们利用普通索引的changebuffer可以大幅度优化性能；

对于changebuffer的应用场景，changebuffer适用于写多读少的场景，因为写到changebuffer上的内容越多，他节省的IO次数也就越多，所以非常适合读多写少的场景；
未完待续……
